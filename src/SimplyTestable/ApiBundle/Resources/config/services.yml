imports:
    - { resource: services/event-listeners.yml }
    - { resource: services/commands.yml }
    - { resource: services/resque-job-factory.yml }

services:
  simplytestable.session.handler:
    class: Symfony\Component\HttpFoundation\Session\Storage\Handler\NullSessionHandler

  FOS\UserBundle\Util\TokenGeneratorInterface:
    alias: fos_user.util.token_generator

  simplytestable.services.webresourceservice:
    class:  webignition\WebResource\Service\Service
    calls:
      - [createConfiguration, [{allow-uknown-resource-types: 'true', retry-with-url-encoding-disabled: 'true', content-type-web-resource-map: '%content_type_web_resource_map%' }]]

  simplytestable.services.sitemapfactory:
    class:  webignition\WebResource\Sitemap\Factory

  SimplyTestable\ApiBundle\Services\HttpClientService:
    arguments:
        $curlOptions: '%curl_options%'

  SimplyTestable\ApiBundle\Services\TaskPreProcessor\Factory:
    arguments:
      $taskPreprocessors:
        - '@SimplyTestable\ApiBundle\Services\TaskPreProcessor\LinkIntegrityTaskPreProcessor'

  SimplyTestable\ApiBundle\Services\UserAccountPlanService:
    arguments:
        $entityManager: '@doctrine.orm.entity_manager'
        $userService: '@SimplyTestable\ApiBundle\Services\UserService'
        $stripeService: '@SimplyTestable\ApiBundle\Services\StripeService'
        $teamService: '@SimplyTestable\ApiBundle\Services\Team\Service'
        $defaultTrialPeriod: '%default_trial_period%'

  SimplyTestable\ApiBundle\Services\StripeService:
    arguments:
        $apiKey: '%stripe_key%'

  SimplyTestable\ApiBundle\Services\TaskOutputJoiner\Factory:
    arguments:
      $taskPreprocessors:
        - '@SimplyTestable\ApiBundle\Services\TaskOutputJoiner\LinkIntegrityTaskOutputJoiner'

  SimplyTestable\ApiBundle\Services\TaskPostProcessor\Factory:
    arguments:
      $taskPreprocessors:
        - '@SimplyTestable\ApiBundle\Services\TaskPostProcessor\UrlDiscoveryTaskPostProcessor'

  SimplyTestable\ApiBundle\Services\TaskTypeDomainsToIgnoreService:
    arguments:
      $domainsToIgnoreByTaskType:
        "css validation": '%css_validation_domains_to_ignore%'
        "js static analysis": '%js_static_analysis_domains_to_ignore%'

  SimplyTestable\ApiBundle\Services\StripeWebHookMailNotificationSender:
    arguments:
      $mailService: '@SimplyTestable\ApiBundle\Services\Mail\Service'
      $parameters: "%stripe_webhook_developer_notification%"
