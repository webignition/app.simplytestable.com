Is called by:

JobController::cancelAction when cancelling crawl job
TaskController::completeByUrlAndTaskTypeAction when last url discovery task of crawl job is completed

Places to look for tests to move/refactor:

Controller/Job/CancelTest
Controller/Task/CompleteForUrlDiscoveryTaskTest

Changes/refactorings needed:

Test JobPreparationService::prepareFromCrawl directly not indirectly via the above
 - examine parent job following crawl job cancellation
 - examine parent job following crawl job completion
 - introduce exception cases to replace return codes
 - check for exception cases 

Controller/Job/CancelTest
test that cancelling crawl job sets correct state on job and tasks, don't examine parent job

Controller/Task/CompleteForUrlDiscoveryTaskTest
test that completing final url discovery task sets correct state on crawl job and parent job, don't examine parent job